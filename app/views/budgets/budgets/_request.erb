<head>
  <script type="text/javascript">
    $(document).ready(function(){

      $("#rbt_mat").change(function(){
         $("#materiales").show()         
         $("#workmanship").hide()
         //$("#workmanship").style ="display: none";
         $("#materiales").checked;
         var x=(document).getElementById('work_quantity');
         x.value = 0;   // Mano de Obra Cantidad = 0

       });
      $("#rbt_work").change(function(){
         $("#materiales").hide()
         //$("#materiales").style ="display: none";
         $("#workmanship").show()
         $("#workmanship").checked;
         $("#mat_quantity").value = 0;
         var x=(document).getElementById('mat_quantity');
         x.value = 0;   // Material Cantidad = 0

       });



      $("#mat_other").hide()
      $("#work_other").hide()

      $(".combo").change(function(){
        var temp = new Array();
        var i=0;
        b = $(".combo  option:selected").text();
        if (b.substr(0,4) == "Otro")
        {
          $("#mat_other").show("fast")
          $("#mat_unit").attr("disabled", "");
        } else
          {
            $("#mat_other").hide("fast");
            $("#mat_unit").attr("disabled", "disabled");
          }


        temp = b.split('$');

        var ls_importe =  temp[1];
        i = ls_importe.indexOf("|");
        ls_importe = ls_importe.substring(0, i);
        //alert(temp[0]);
        var x=(document).getElementById('mat_import');
        x.value = ls_importe;   //temp[1];


        //--Unidad de medida
        temp = b.split('|');
        var x=(document).getElementById('mat_unit');
        x.value = temp[1];

        //$('.tsupplies').append("<tr><td> liliana </td></tr>");



        return false;
      });

      $(".combo_work").change(function(){
        var temp = new Array();
        var i=0;
        b = $(".combo_work  option:selected").text();
        if (b.substr(0,4) == "Otro")
        {
          $("#work_other").show("fast")
          $("#work_unit").attr("disabled", "");
        }
        else
        {
          $("#work_other").hide("fast");
          $("#work_unit").attr("disabled", "disabled");
        }


        temp = b.split('$');

        var ls_importe =  temp[1];
        i = ls_importe.indexOf("|");
        ls_importe = ls_importe.substring(0, i);
        //alert(temp[0]);
        var x=(document).getElementById('work_import');
        x.value = ls_importe;   //temp[1];


        //--Unidad de medida
        temp = b.split('|');
        var x=(document).getElementById('work_unit');
        x.value = temp[1];

        //$('.tsupplies').append("<tr><td> liliana </td></tr>");

        //alert(x.value);
        //$(this).hide() eOK
        //$("ul").append("<li>Ultima</li>")
        //$(".tipo").hide() OK


        return false;
      });



    });
    </script>

</head>



<% @requests_support_request.id %>
<table class="table1" width="950">
<tr>

  <td width="80" align=right >
     <b>Folio:</b>
  </td>
  <td align="left">
     <%= @budgets_budget.request.num_sequence %>
  </td>

  <td> <b> Creado el:</b></td>
  <td align="left"><%=  @budgets_budget.request.created_at.strftime("%d/%m/%Y") %></td>
  <td> <b> Ultimo cambio:</b></td>
  <td align="left"><%=  @budgets_budget.request.status_chng_date.strftime("%d/%m/%Y") %></td>
</tr>

<tr>
  <td width="30" align=right >
    <b>Ubicación:</b>
  </td>
  <td align="left">
    <%= @budgets_budget.request.ubication_name %>
  </td>
  <td width="60" align=right>
    <b>Atiende:</b>
  </td>
  <td align ="left" colspan="3">
    <%= @budgets_budget.request.helper %>
  </td>
</tr>


<tr class="table_content_c2">
  <td width="30" align=right >
    <b>Nombre:</b>
  </td>
  <td align="left">
    <%= @budgets_budget.request.name %>
  </td>
  <td width="70" align=right>
    <b>Correo E.:</b>
  </td>
  <td align ="left" colspan="3">
    <%= @budgets_budget.request.email %>
  </td>
</tr>


<tr class="table_content_c2">
  <td width="80" align=right >
     <b>Descripción:</b>
  </td>
  <td align="left" colspan="5">
     <%= raw(@budgets_budget.request.text_to_html(@budgets_budget.request.description)) %>
  </td>
</tr>

</table>


<%= form_for(@budgets_budget, :remote=> true) do |f| %>

  <% if @budgets_budget.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@budgets_budget.errors.count, "error") %> prohibited this budgets_budget from being saved:</h2>

      <ul>
      <% @budgets_budget.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

 <%=  f.text_field :support_request_id, :type => "hidden" %>

<table width="950" class="table1">
  <tr>
    <td width="80" align="right" valign="top">
      <b> Descripción Técnica </b>
    </td>
    <td align="left" colspan="3">
      <%= f.text_area :tech_description,  :size => '100%'  %>
    </td>
  </tr>
  <tr>
    <td width="80" align="right" valign="top">
      <b> Descripción de Trabajos </b>
    </td>
    <td align="left"  colspan="3">
      <%= f.text_area :description,  :size => '100%'  %>
    </td>
  </tr>
  <tr>
    <td width="80" align="right">
       <b> Tipo de Soporte:</b>
    </td>
    <td align="left" colspan="3">
       <%= select :budgets_budget , :support_type_id, Catalogs::SupportType.find(:all).collect{|p| [p.name, p.id]}%>
    </td>
  </tr>
  <% if $display_supplies == 0 %>
  <tr>
    <td width="80" align="right">
       <b> Empresa:</b>
    </td>
    <td align="left">
       <%= select :budgets_budget , :supplier_id, Catalogs::Supplier.find(:all).collect{|p| [p.trade_name, p.id]}%>
    </td>
    <td align="right" width="80">
      <b> Costo: </b>
    </td>
    <td align="left" width="80">
      <%= f.text_field :total_cost, :size=>"13", :style => "text-align: right" %>
    </td>
  </tr>
  <% end %>

</table>

  <% if $display_supplies == 1 %>
  <hr />
  <table>
    <%= form_tag do %>
    <tr>
      <td id="rbt_mat" ><%= radio_button_tag "shared_name", "1st_button",true %>Materiales</td>
      <td id="rbt_work"><%= radio_button_tag "shared_name", "2nd_button",false %>Mano de Obra</td>
    </tr>
    <% end %>
    </table>

<div id="materiales">
  
   <table>
     <tr>
       <td>
         <div class="combo">
         <%= f.label :mat_description, "Material:" %>
         <%= select  :budgets_budget , :mat_description,  Catalogs::Supply.find(:all,  :conditions => "type_supply = 1").collect{|p| [p.description + " $ " + p.unit_cost.to_s + "|" + p.unit_measure, p.description]},{:prompt => 'Seleccione el Material'},:onclick => "document.getElementById('mat_quantity').value=0; return true;",:width=>35 %>
        </div>
          <%= f.text_field :mat_other, :id=>'mat_other',:size=>"35"%>
       </td>
       <td>
        <%= f.label :mat_quantity, "Cantidad:" %>
        <%= f.text_field :mat_quantity, :size=>"8", :style => "text-align: right", :id=>"mat_quantity" %>
       </td>
       <td>
        <%= f.label :mat_import, "Importe:" %>
        <%= f.text_field :mat_import, :size=>"8", :style => "text-align: right", :id=>"mat_import" %>
       </td>
       <td>
        <%= f.label :mat_unit, "Unidad:" %>
        <%= f.text_field :mat_unit, :size=>"8", :style => "text-align: right", :id=>"mat_unit", :disabled => 'disabled' %>
        <%= f.hidden_field :mat_type, :id=>"type_supply", :value=>"1"  %>
       </td>
       <td><%= f.submit "Agregar", :name=>'material', :remote=>true,  :onclick => "document.getElementById('mat_unit').disabled = false; return true;" %></td>
     </tr>
     <tr>
     </tr>
   </table>
  <hr />
</div>


<div id="workmanship"  style="display :none;">
   <table>
     <tr>
       <td>
         <div class="combo_work">
         <%= f.label :work_description, "Mano de Obra:" %>
         <%= select  :budgets_budget , :work_description,  Catalogs::Supply.find(:all,  :conditions => "type_supply = 2").collect{|p| [p.description + " $ " + p.unit_cost.to_s + "|" + p.unit_measure, p.description]},{:prompt => 'Seleccione Mano de Obra'},:onclick => "document.getElementById('work_quantity').value=0; return true;" %>
        </div>
          <%= f.text_field :work_other, :id=>'work_other',:size=>"35", :style=>"display :none;"%>
       </td>
       <td>
        <%= f.label :work_quantity, "Cantidad:" %>
        <%= f.text_field :work_quantity, :size=>"8", :style => "text-align: right", :id=>"work_quantity" %>
       </td>
       <td>
        <%= f.label :work_import, "Importe:" %>
        <%= f.text_field :work_import, :size=>"8", :style => "text-align: right", :id=>"work_import" %>
       </td>
       <td>
        <%= f.label :work_unit, "Unidad:" %>
        <%= f.text_field :work_unit, :size=>"8", :style => "text-align: right", :id=>"work_unit", :disabled => 'disabled' %>
         <%= f.hidden_field :work_type, :id=>"type_supply", :value=>"2"  %>
       </td>
       <td><%= f.submit "Agregar", :name=>'material', :remote=>true, :onclick => "document.getElementById('mat_unit').disabled = false; return true;" %></td>
     </tr>
     <tr>
     </tr>
   </table>
   <hr />
</div>

     <div id="mat_list">
       <h3> Materiales</h3>
       <%= render :partial => 'supplies'%>
     </div>

     <div id="work_list">
       <h3> Mano de Obra</h3>
       <%= render :partial => 'workmanships'%>
     </div>



  <% end %>

<%= f.submit 'Guardar Presupuesto', :onclick => "document.getElementById('cantidad').value=-999.99; return true;"%>


<% end %>



